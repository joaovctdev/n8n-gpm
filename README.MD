# Mariua Login Service

Servi√ßo de login automatizado usando Puppeteer para contornar bloqueios anti-bot.

## üöÄ Como Usar

### Op√ß√£o 1: Rodar Localmente

```bash
# Instalar depend√™ncias
npm install

# Rodar o servi√ßo
npm start
```

O servi√ßo vai rodar em `http://localhost:3000`

### Op√ß√£o 2: Docker

```bash
# Build
docker build -t mariua-login-service .

# Run
docker run -p 3000:3000 mariua-login-service
```

### Op√ß√£o 3: Deploy na Nuvem

Recomendado: **Railway.app**, **Render.com** ou **Fly.io** (todos t√™m plano gratuito)

#### Railway.app (Mais F√°cil)
1. Criar conta em https://railway.app
2. "New Project" ‚Üí "Deploy from GitHub repo"
3. Conectar este reposit√≥rio
4. Railway detecta automaticamente o Dockerfile
5. Deploy autom√°tico! ‚úÖ

## üì° API

### POST /login

Fazer login e retornar cookies de sess√£o.

**Request:**
```json
{
  "usuario": "JOAO.ALMEIDA",
  "senha": "mariua@2025"
}
```

**Response (Sucesso):**
```json
{
  "success": true,
  "authenticated": true,
  "cookies": {
    "PHPSESSID": "...",
    "AWSALB": "...",
    "AWSALBCORS": "..."
  },
  "cookieString": "PHPSESSID=...; AWSALB=...; AWSALBCORS=...",
  "PHPSESSID": "...",
  "homeUrl": "https://mariua.gpm.srv.br/ci/Geral/Home",
  "timestamp": "2026-01-30T01:52:00.000Z"
}
```

**Response (Erro):**
```json
{
  "success": false,
  "error": "LOGIN_FAILED",
  "message": "Credenciais incorretas"
}
```

## üîß Integra√ß√£o com N8N

1. Deploy do servi√ßo (Railway, Render, etc)
2. No N8N, usar node "HTTP Request":

```
Method: POST
URL: https://seu-servico.railway.app/login
Body:
{
  "usuario": "{{$json.usuario}}",
  "senha": "{{$json.senha}}"
}
```

3. Extrair cookies da resposta:
```javascript
const response = $input.item.json;
if (response.success) {
  return {
    cookieString: response.cookieString,
    PHPSESSID: response.PHPSESSID
  };
}
```

## ‚öôÔ∏è Vari√°veis de Ambiente

- `PORT`: Porta do servi√ßo (padr√£o: 3000)

## üìù Notas

- O servi√ßo usa Puppeteer em modo headless
- Simula navegador Chrome real
- Contorna bloqueios anti-bot
- Retorna cookies v√°lidos por ~3 horas